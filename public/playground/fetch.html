<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Data Fetching - Esor</title>
  <style>
    body { margin: 0; padding: 0; font-family: system-ui, sans-serif; }
  </style>
</head>
<body>
  <random-user></random-user>
  <script type="module" crossorigin>
import { component, html, signal, effect } from "https://cdn.jsdelivr.net/npm/esor@latest/dist/esor.js";

component("random-user", () => {
  const user = signal(null);
  const loading = signal(false);
  let currentController = null;

  const fetchUser = async () => {
    if (currentController) {
      currentController.abort();
    }
    currentController = new AbortController();
    const { signal } = currentController;

    loading(true);
    try {
      const res = await fetch('https://randomuser.me/api/', { signal });
      const data = await res.json();
      user(data.results[0]);
    } catch (error) {
      if (error.name !== 'AbortError') {
        console.error('Error:', error);
      }
    } finally {
      if (!signal.aborted) {
        loading(false);
      }
    }
  };

  effect(() => {
    fetchUser();
  });

  return html`
    <style>
      :host {
        display: block;
        max-width: 400px;
        margin: 20px auto;
        font-family: system-ui, sans-serif;
      }

      .container {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        text-align: center;
      }

      h2 {
        color: #2c3e50;
        margin-bottom: 20px;
      }

      .avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        margin: 0 auto 15px;
      }

      .name {
        font-size: 1.5rem;
        font-weight: bold;
        color: #34495e;
        margin: 10px 0 5px;
      }

      .email {
        color: #7f8c8d;
        margin: 5px 0;
      }

      button {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        margin-top: 15px;
      }

      .loading {
        color: #7f8c8d;
        padding: 40px;
      }
    </style>

    <div class="container">
      <h2>ðŸŽ² Random User Generator</h2>
      ${loading() ? html`<div class="loading">Loading...</div>` : user() ? html`
        <div>
          <img class="avatar" src="${user().picture.large}" alt="User" />
          <div class="name">${user().name.first} ${user().name.last}</div>
          <div class="email">${user().email}</div>
          <button @click=${fetchUser}>Get Another User</button>
        </div>
      ` : null}
    </div>
  `;
});
  </script>
</body>
</html>
